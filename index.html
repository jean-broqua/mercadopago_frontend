<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <title>Document</title>
  </head>
  <body>
    <!-- Step #2 -->
    <form id="form-checkout">
      <input type="text" name="cardNumber" id="form-checkout__cardNumber" />
      <input
        type="text"
        name="cardExpirationDate"
        id="form-checkout__cardExpirationDate"
      />
      <input
        type="text"
        name="cardholderName"
        id="form-checkout__cardholderName"
      />
      <input
        type="email"
        name="cardholderEmail"
        id="form-checkout__cardholderEmail"
      />
      <input type="text" name="securityCode" id="form-checkout__securityCode" />
      <select name="issuer" id="form-checkout__issuer"></select>
      <select
        name="identificationType"
        id="form-checkout__identificationType"
      ></select>
      <input
        type="text"
        name="identificationNumber"
        id="form-checkout__identificationNumber"
      />
      <select name="installments" id="form-checkout__installments"></select>
      <button type="submit" id="form-checkout__submit">Pagar</button>
      <progress value="0" class="progress-bar">Carregando...</progress>
    </form>

    <script>
      const mp = new MercadoPago('APP_USR-209f3144-40f6-4f4d-ae4c-9716429abfbc')
      const cardForm = mp.cardForm({
        amount: '100.5',
        autoMount: true,
        form: {
          id: 'form-checkout',
          cardholderName: {
            id: 'form-checkout__cardholderName',
            placeholder: 'Titular do cartão'
          },
          cardholderEmail: {
            id: 'form-checkout__cardholderEmail',
            placeholder: 'E-mail'
          },
          cardNumber: {
            id: 'form-checkout__cardNumber',
            placeholder: 'Número do cartão'
          },
          cardExpirationDate: {
            id: 'form-checkout__cardExpirationDate',
            placeholder: 'Data de vencimento (MM/YYYY)'
          },
          securityCode: {
            id: 'form-checkout__securityCode',
            placeholder: 'Código de segurança'
          },
          installments: {
            id: 'form-checkout__installments',
            placeholder: 'Parcelas'
          },
          identificationType: {
            id: 'form-checkout__identificationType',
            placeholder: 'Tipo de documento'
          },
          identificationNumber: {
            id: 'form-checkout__identificationNumber',
            placeholder: 'Número do documento'
          },
          issuer: {
            id: 'form-checkout__issuer',
            placeholder: 'Banco emissor'
          }
        },
        callbacks: {
          onFormMounted: (error) => {
            if (error)
              return console.warn('Form Mounted handling error: ', error)
            console.log('Form mounted')
          },
          onSubmit: (event) => {
            event.preventDefault()

            console.log(
              ({
                paymentMethodId: payment_method_id,
                issuerId: issuer_id,
                cardholderEmail: email,
                amount,
                token,
                installments,
                identificationNumber,
                identificationType
              } = cardForm.getCardFormData())
            )
          },
          onFetching: (resource) => {
            console.log('Fetching resource: ', resource)

            // Animate progress bar
            const progressBar = document.querySelector('.progress-bar')
            progressBar.removeAttribute('value')

            return () => {
              progressBar.setAttribute('value', '0')
            }
          }
        }
      })
    </script>
  </body>
</html>
